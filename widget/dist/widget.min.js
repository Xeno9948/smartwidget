!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.KiyohAIWidget=t():n.KiyohAIWidget=t()}(this,()=>(()=>{"use strict";var n={};function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(n)}function r(n,t){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){r&&(n=r);var o=0,a=function(){};return{s:a,n:function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){r=r.call(n)},n:function(){var n=r.next();return c=n.done,n},e:function(n){u=!0,i=n},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}function e(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=Array(t);r<t;r++)e[r]=n[r];return e}function o(){var n,t,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function c(r,e,o,i){var c=e&&e.prototype instanceof s?e:s,l=Object.create(c.prototype);return a(l,"_invoke",function(r,e,o){var a,i,c,s=0,l=o||[],p=!1,d={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(t,r){return a=t,i=0,c=n,d.n=r,u}};function f(r,e){for(i=r,c=e,t=0;!p&&s&&!o&&t<l.length;t++){var o,a=l[t],f=d.p,b=a[2];r>3?(o=b===e)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,d.v=e,d.n=a[1]):f<b&&(o=r<3||a[0]>e||e>b)&&(a[4]=r,a[5]=e,d.n=b,i=0))}if(o||r>1)return u;throw p=!0,e}return function(o,l,b){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&f(l,b),i=l,c=b;(t=i<2?n:c)||!p;){a||(i?i<3?(i>1&&(d.n=-1),f(i,c)):d.n=c:d.v=c);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((t=(p=d.n<0)?c:r.call(e,d))!==u)break}catch(t){a=n,i=1,c=t}finally{s=1}}return{value:t,done:p}}}(r,o,i),!0),l}var u={};function s(){}function l(){}function p(){}t=Object.getPrototypeOf;var d=[][e]?t(t([][e]())):(a(t={},e,function(){return this}),t),f=p.prototype=s.prototype=Object.create(d);function b(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,p):(n.__proto__=p,a(n,i,"GeneratorFunction")),n.prototype=Object.create(f),n}return l.prototype=p,a(f,"constructor",p),a(p,"constructor",l),l.displayName="GeneratorFunction",a(p,i,"GeneratorFunction"),a(f),a(f,i,"Generator"),a(f,e,function(){return this}),a(f,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:b}})()}function a(n,t,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}a=function(n,t,r,e){function i(t,r){a(n,t,function(n){return this._invoke(t,r,n)})}t?o?o(n,t,{value:r,enumerable:!e,configurable:!e,writable:!e}):n[t]=r:(i("next",0),i("throw",1),i("return",2))},a(n,t,r,e)}function i(n,t,r,e,o,a,i){try{var c=n[a](i),u=c.value}catch(n){return void r(n)}c.done?t(u):Promise.resolve(u).then(e,o)}function c(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,u(e.key),e)}}function u(n){var r=function(n,r){if("object"!=t(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var o=e.call(n,r||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(n)}(n,"string");return"symbol"==t(r)?r:r+""}const s=function(){return n=function n(){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n)},e=null,a=[{key:"detect",value:(u=o().m(function n(){var t,r,e,a,i;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:t=[this.detectFromJSONLD,this.detectFromMetaTags,this.detectFromMicrodata,this.detectFromDataAttributes,this.detectFromPlatformSpecific],r=0,e=t;case 1:if(!(r<e.length)){n.n=7;break}return a=e[r],n.p=2,n.n=3,a.call(this);case 3:if(!(i=n.v)||!this.validateGTIN(i)){n.n=4;break}return n.a(2,i);case 4:n.n=6;break;case 5:n.p=5,n.v;case 6:r++,n.n=1;break;case 7:return n.a(2,null)}},n,this,[[2,5]])}),s=function(){var n=this,t=arguments;return new Promise(function(r,e){var o=u.apply(n,t);function a(n){i(o,r,e,a,c,"next",n)}function c(n){i(o,r,e,a,c,"throw",n)}a(void 0)})},function(){return s.apply(this,arguments)})},{key:"detectFromJSONLD",value:function(){var n,t=r(document.querySelectorAll('script[type="application/ld+json"]'));try{for(t.s();!(n=t.n()).done;){var e=n.value;try{var o=JSON.parse(e.textContent),a=this.findGTINInObject(o);if(a)return a}catch(n){continue}}}catch(n){t.e(n)}finally{t.f()}return null}},{key:"findGTINInObject",value:function(n){if(!n||"object"!==t(n))return null;for(var r=0,e=["gtin","gtin13","gtin12","gtin14","gtin8","ean","isbn"];r<e.length;r++){var o=e[r];if(n[o])return String(n[o])}for(var a in n)if("object"===t(n[a])){var i=this.findGTINInObject(n[a]);if(i)return i}return null}},{key:"detectFromMetaTags",value:function(){for(var n=0,t=['meta[property="product:gtin"]','meta[property="og:product:gtin"]','meta[property="product:ean"]','meta[name="gtin"]','meta[name="gtin13"]','meta[name="ean"]','meta[itemprop="gtin"]','meta[itemprop="gtin13"]'];n<t.length;n++){var r=t[n],e=document.querySelector(r);if(e){var o=e.getAttribute("content");if(o)return o}}return null}},{key:"detectFromMicrodata",value:function(){for(var n=0,t=['[itemprop="gtin"]','[itemprop="gtin13"]','[itemprop="gtin12"]','[itemprop="gtin14"]','[itemprop="gtin8"]','[itemprop="ean"]'];n<t.length;n++){var r=t[n],e=document.querySelector(r);if(e){var o=e.getAttribute("content")||e.textContent;if(o)return o.trim()}}return null}},{key:"detectFromDataAttributes",value:function(){for(var n=0,t=["[data-gtin]","[data-ean]","[data-product-gtin]","[data-product-ean]","[data-product-code]"];n<t.length;n++){var r=t[n],e=document.querySelector(r);if(e)for(var o=0,a=["data-gtin","data-ean","data-product-gtin","data-product-ean","data-product-code"];o<a.length;o++){var i=a[o],c=e.getAttribute(i);if(c)return c}}return null}},{key:"detectFromPlatformSpecific",value:function(){var n,t,r=document.querySelector(".product_meta .sku");if(r&&this.looksLikeGTIN(r.textContent))return r.textContent.trim();if(null!==(n=window.ShopifyAnalytics)&&void 0!==n&&null!==(n=n.meta)&&void 0!==n&&null!==(n=n.product)&&void 0!==n&&n.variants){var e,o=null===(e=window.ShopifyAnalytics.meta.product.variants[0])||void 0===e?void 0:e.sku;if(o&&this.looksLikeGTIN(o))return o}if(null!==(t=window.dlv_dataLayer)&&void 0!==t&&null!==(t=t.product)&&void 0!==t&&t.sku){var a=window.dlv_dataLayer.product.sku;if(this.looksLikeGTIN(a))return a}var i=document.querySelector(".product-ean, .product__ean");return i?i.textContent.trim():null}},{key:"looksLikeGTIN",value:function(n){if(!n)return!1;var t=n.replace(/\D/g,"");return[8,12,13,14].includes(t.length)}},{key:"validateGTIN",value:function(n){if(!n)return!1;var t=String(n).replace(/\D/g,"");return!![8,12,13,14].includes(t.length)&&this.validateChecksum(t)}},{key:"validateChecksum",value:function(n){for(var t=n.split("").map(Number),r=t.pop(),e=0,o=t.length-1;o>=0;o--){var a=(t.length-o)%2==0?3:1;e+=t[o]*a}return(10-e%10)%10===r}}],e&&c(n.prototype,e),a&&c(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,a,u,s}();function l(n){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},l(n)}function p(){var n,t,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,e,o,a){var u=e&&e.prototype instanceof c?e:c,s=Object.create(u.prototype);return d(s,"_invoke",function(r,e,o){var a,c,u,s=0,l=o||[],p=!1,d={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(t,r){return a=t,c=0,u=n,d.n=r,i}};function f(r,e){for(c=r,u=e,t=0;!p&&s&&!o&&t<l.length;t++){var o,a=l[t],f=d.p,b=a[2];r>3?(o=b===e)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=f&&((o=r<2&&f<a[1])?(c=0,d.v=e,d.n=a[1]):f<b&&(o=r<3||a[0]>e||e>b)&&(a[4]=r,a[5]=e,d.n=b,c=0))}if(o||r>1)return i;throw p=!0,e}return function(o,l,b){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&f(l,b),c=l,u=b;(t=c<2?n:u)||!p;){a||(c?c<3?(c>1&&(d.n=-1),f(c,u)):d.n=u:d.v=u);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((t=(p=d.n<0)?u:r.call(e,d))!==i)break}catch(t){a=n,c=1,u=t}finally{s=1}}return{value:t,done:p}}}(r,o,a),!0),s}var i={};function c(){}function u(){}function s(){}t=Object.getPrototypeOf;var l=[][e]?t(t([][e]())):(d(t={},e,function(){return this}),t),f=s.prototype=c.prototype=Object.create(l);function b(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,s):(n.__proto__=s,d(n,o,"GeneratorFunction")),n.prototype=Object.create(f),n}return u.prototype=s,d(f,"constructor",s),d(s,"constructor",u),u.displayName="GeneratorFunction",d(s,o,"GeneratorFunction"),d(f),d(f,o,"Generator"),d(f,e,function(){return this}),d(f,"toString",function(){return"[object Generator]"}),(p=function(){return{w:a,m:b}})()}function d(n,t,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}d=function(n,t,r,e){function a(t,r){d(n,t,function(n){return this._invoke(t,r,n)})}t?o?o(n,t,{value:r,enumerable:!e,configurable:!e,writable:!e}):n[t]=r:(a("next",0),a("throw",1),a("return",2))},d(n,t,r,e)}function f(n,t,r,e,o,a,i){try{var c=n[a](i),u=c.value}catch(n){return void r(n)}c.done?t(u):Promise.resolve(u).then(e,o)}function b(n){return function(){var t=this,r=arguments;return new Promise(function(e,o){var a=n.apply(t,r);function i(n){f(a,e,o,i,c,"next",n)}function c(n){f(a,e,o,i,c,"throw",n)}i(void 0)})}}function v(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,m(e.key),e)}}function m(n){var t=function(n,t){if("object"!=l(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var e=r.call(n,t||"default");if("object"!=l(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"==l(t)?t:t+""}const g=function(){return n=function n(t){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.baseUrl=t||"http://localhost:3000/api/v1"},t=[{key:"askQuestion",value:(a=b(p().m(function n(t,r,e){var o,a,i,c=arguments;return p().w(function(n){for(;;)switch(n.n){case 0:return o=c.length>3&&void 0!==c[3]?c[3]:"nl",n.n=1,fetch("".concat(this.baseUrl,"/qa"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locationId:t,productCode:e,question:r,language:o})});case 1:if((a=n.v).ok){n.n=3;break}return n.n=2,a.json().catch(function(){return{error:"Network error"}});case 2:throw i=n.v,new Error(i.error||"HTTP ".concat(a.status));case 3:return n.n=4,a.json();case 4:return n.a(2,n.v)}},n,this)})),function(n,t,r){return a.apply(this,arguments)})},{key:"getPopularQuestions",value:(o=b(p().m(function n(t){var r,e,o=arguments;return p().w(function(n){for(;;)switch(n.n){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:5,n.n=1,fetch("".concat(this.baseUrl,"/qa/popular/").concat(t,"?limit=").concat(r));case 1:if((e=n.v).ok){n.n=2;break}throw new Error("HTTP ".concat(e.status));case 2:return n.n=3,e.json();case 3:return n.a(2,n.v)}},n,this)})),function(n){return o.apply(this,arguments)})},{key:"getQAHistory",value:(e=b(p().m(function n(t){var r,e,o=arguments;return p().w(function(n){for(;;)switch(n.n){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:10,n.n=1,fetch("".concat(this.baseUrl,"/qa/history/").concat(t,"?limit=").concat(r));case 1:if((e=n.v).ok){n.n=2;break}throw new Error("HTTP ".concat(e.status));case 2:return n.n=3,e.json();case 3:return n.a(2,n.v)}},n,this)})),function(n){return e.apply(this,arguments)})}],t&&v(n.prototype,t),r&&v(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,t,r,e,o,a}();function y(n){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},y(n)}function h(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,e)}return r}function w(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){x(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function x(n,t,r){return(t=T(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function k(){var n,t,r="function"==typeof Symbol?Symbol:{},e=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,e,o,a){var u=e&&e.prototype instanceof c?e:c,s=Object.create(u.prototype);return S(s,"_invoke",function(r,e,o){var a,c,u,s=0,l=o||[],p=!1,d={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(t,r){return a=t,c=0,u=n,d.n=r,i}};function f(r,e){for(c=r,u=e,t=0;!p&&s&&!o&&t<l.length;t++){var o,a=l[t],f=d.p,b=a[2];r>3?(o=b===e)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=f&&((o=r<2&&f<a[1])?(c=0,d.v=e,d.n=a[1]):f<b&&(o=r<3||a[0]>e||e>b)&&(a[4]=r,a[5]=e,d.n=b,c=0))}if(o||r>1)return i;throw p=!0,e}return function(o,l,b){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&f(l,b),c=l,u=b;(t=c<2?n:u)||!p;){a||(c?c<3?(c>1&&(d.n=-1),f(c,u)):d.n=u:d.v=u);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((t=(p=d.n<0)?u:r.call(e,d))!==i)break}catch(t){a=n,c=1,u=t}finally{s=1}}return{value:t,done:p}}}(r,o,a),!0),s}var i={};function c(){}function u(){}function s(){}t=Object.getPrototypeOf;var l=[][e]?t(t([][e]())):(S(t={},e,function(){return this}),t),p=s.prototype=c.prototype=Object.create(l);function d(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,s):(n.__proto__=s,S(n,o,"GeneratorFunction")),n.prototype=Object.create(p),n}return u.prototype=s,S(p,"constructor",s),S(s,"constructor",u),u.displayName="GeneratorFunction",S(s,o,"GeneratorFunction"),S(p),S(p,o,"Generator"),S(p,e,function(){return this}),S(p,"toString",function(){return"[object Generator]"}),(k=function(){return{w:a,m:d}})()}function S(n,t,r,e){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}S=function(n,t,r,e){function a(t,r){S(n,t,function(n){return this._invoke(t,r,n)})}t?o?o(n,t,{value:r,enumerable:!e,configurable:!e,writable:!e}):n[t]=r:(a("next",0),a("throw",1),a("return",2))},S(n,t,r,e)}function j(n,t,r,e,o,a,i){try{var c=n[a](i),u=c.value}catch(n){return void r(n)}c.done?t(u):Promise.resolve(u).then(e,o)}function O(n){return function(){var t=this,r=arguments;return new Promise(function(e,o){var a=n.apply(t,r);function i(n){j(a,e,o,i,c,"next",n)}function c(n){j(a,e,o,i,c,"throw",n)}i(void 0)})}}function P(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,T(e.key),e)}}function T(n){var t=function(n,t){if("object"!=y(n)||!n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var e=r.call(n,t||"default");if("object"!=y(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"==y(t)?t:t+""}function q(n,t,r){return t=_(t),function(n,t){if(t&&("object"==y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}(n,E()?Reflect.construct(t,r||[],_(n).constructor):t.apply(n,r))}function C(n){var t="function"==typeof Map?new Map:void 0;return C=function(n){if(null===n||!function(n){try{return-1!==Function.toString.call(n).indexOf("[native code]")}catch(t){return"function"==typeof n}}(n))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(n))return t.get(n);t.set(n,r)}function r(){return function(n,t,r){if(E())return Reflect.construct.apply(null,arguments);var e=[null];e.push.apply(e,t);var o=new(n.bind.apply(n,e));return r&&I(o,r.prototype),o}(n,arguments,_(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),I(r,n)},C(n)}function E(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(n){}return(E=function(){return!!n})()}function I(n,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},I(n,t)}function _(n){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},_(n)}var G=function(n){function t(){var n;return function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=q(this,t)).attachShadow({mode:"open"}),n.state={locationId:null,apiToken:null,productCode:null,autoDetect:!0,language:"nl",primaryColor:"#00a0dc",showProductInfo:!0,apiBaseUrl:null,loading:!1,error:null,answer:null,popularQuestions:[]},n.apiClient=null,n}return function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&I(n,t)}(t,n),r=t,e=[{key:"attributeChangedCallback",value:function(n,t,r){var e={"data-location-id":"locationId","data-product-code":"productCode","data-auto-detect":"autoDetect","data-language":"language","data-primary-color":"primaryColor","data-show-product-info":"showProductInfo","data-api-base-url":"apiBaseUrl"}[n];e&&(this.state[e]="autoDetect"===e||"showProductInfo"===e?"false"!==r:r)}},{key:"connectedCallback",value:(u=O(k().m(function n(){return k().w(function(n){for(;;)switch(n.n){case 0:return this.render(),n.n=1,this.initialize();case 1:return n.a(2)}},n,this)})),function(){return u.apply(this,arguments)})},{key:"initialize",value:(c=O(k().m(function n(){var t;return k().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,this.state.locationId){n.n=1;break}throw new Error("data-location-id is required");case 1:if(this.apiClient=new g(this.state.apiBaseUrl||"https://your-api-domain.com/api/v1"),!this.state.autoDetect||this.state.productCode){n.n=3;break}return n.n=2,s.detect();case 2:this.state.productCode=n.v,this.state.productCode;case 3:return n.n=4,this.loadPopularQuestions();case 4:this.render(),n.n=6;break;case 5:n.p=5,t=n.v,this.setState({error:t.message});case 6:return n.a(2)}},n,this,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"loadPopularQuestions",value:(i=O(k().m(function n(){var t;return k().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,this.apiClient.getPopularQuestions(this.state.locationId,5);case 1:(t=n.v).success&&t.data.questions.length>0&&this.setState({popularQuestions:t.data.questions.slice(0,5)}),n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"setState",value:function(n){this.state=w(w({},this.state),n),this.render()}},{key:"handleSubmit",value:(a=O(k().m(function n(t){var r,e,o,a,i=this;return k().w(function(n){for(;;)switch(n.p=n.n){case 0:if(t.preventDefault(),r=this.shadowRoot.querySelector(".question-input"),e=r.value.trim()){n.n=1;break}return n.a(2);case 1:if(this.state.productCode){n.n=2;break}return this.setState({error:"Product code (GTIN) not found. Please add data-product-code attribute."}),n.a(2);case 2:return this.setState({loading:!0,error:null,answer:null}),n.p=3,n.n=4,this.apiClient.askQuestion(this.state.locationId,e,this.state.productCode,this.state.language);case 4:(o=n.v).success&&(this.setState({loading:!1,answer:o.data}),setTimeout(function(){var n=i.shadowRoot.querySelector(".answer-container");n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})},100)),n.n=6;break;case 5:n.p=5,a=n.v,this.setState({loading:!1,error:a.message||"Failed to get answer. Please try again."});case 6:return n.a(2)}},n,this,[[3,5]])})),function(n){return a.apply(this,arguments)})},{key:"handlePopularQuestionClick",value:function(n){var t=this.shadowRoot.querySelector(".question-input");t.value=n,t.focus(),this.shadowRoot.querySelector("form").dispatchEvent(new Event("submit"))}},{key:"handleInputChange",value:function(n){var t=this.shadowRoot.querySelector(".char-counter");t&&(t.textContent="".concat(n.target.value.length,"/500"))}},{key:"renderStars",value:function(n){var t=Math.floor(n/2),r=n/2%1>=.5,e="‚òÖ".repeat(t);return r&&(e+="‚òÜ"),e.padEnd(5,"‚òÜ")}},{key:"render",value:function(){var n=this,t=this.state,r=t.answer,e=t.loading,o=t.error,a=t.popularQuestions;this.shadowRoot.innerHTML="\n      <style>".concat("\n  :host {\n    --primary-color: var(--kiyoh-primary, #00a0dc);\n    --primary-rgb: 0, 160, 220;\n    --glass-bg: rgba(255, 255, 255, 0.7);\n    --glass-border: rgba(255, 255, 255, 0.3);\n    --glass-shadow: rgba(0, 0, 0, 0.1);\n    --text-primary: #1a1a1a;\n    --text-secondary: #666;\n    --border-radius: 20px;\n    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n\n    display: block;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;\n    font-size: 16px;\n    line-height: 1.5;\n    color: var(--text-primary);\n  }\n\n  * {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n  }\n\n  .widget-container {\n    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    border: 1px solid var(--glass-border);\n    border-radius: var(--border-radius);\n    padding: 2rem;\n    max-width: 800px;\n    margin: 0 auto;\n    box-shadow:\n      0 8px 32px var(--glass-shadow),\n      0 2px 8px rgba(0, 0, 0, 0.05),\n      inset 0 1px 0 rgba(255, 255, 255, 0.8);\n    position: relative;\n    overflow: hidden;\n  }\n\n  .widget-container::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(90deg,\n      transparent,\n      var(--primary-color),\n      transparent\n    );\n    opacity: 0.5;\n  }\n\n  .product-header {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    padding: 1.5rem;\n    background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05) 0%, rgba(var(--primary-rgb), 0.02) 100%);\n    border-radius: 16px;\n    border: 1px solid rgba(var(--primary-rgb), 0.1);\n    margin-bottom: 2rem;\n    transition: var(--transition);\n  }\n\n  .product-header:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 8px 24px rgba(var(--primary-rgb), 0.15);\n  }\n\n  .product-image {\n    width: 80px;\n    height: 80px;\n    border-radius: 12px;\n    object-fit: cover;\n    border: 2px solid rgba(255, 255, 255, 0.8);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  }\n\n  .product-info {\n    flex: 1;\n  }\n\n  .product-name {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 0.5rem;\n  }\n\n  .product-rating {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n  }\n\n  .stars {\n    color: #fbbf24;\n    font-size: 1.1rem;\n  }\n\n  .question-input-container {\n    margin-bottom: 2rem;\n  }\n\n  .input-label {\n    display: block;\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 0.75rem;\n    font-size: 1rem;\n  }\n\n  .question-input {\n    width: 100%;\n    padding: 1rem 1.25rem;\n    border: 2px solid transparent;\n    border-radius: 14px;\n    background: rgba(255, 255, 255, 0.9);\n    backdrop-filter: blur(10px);\n    font-size: 1rem;\n    font-family: inherit;\n    color: var(--text-primary);\n    transition: var(--transition);\n    resize: vertical;\n    min-height: 100px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n  }\n\n  .question-input:focus {\n    outline: none;\n    border-color: var(--primary-color);\n    box-shadow:\n      0 4px 16px rgba(var(--primary-rgb), 0.2),\n      0 0 0 4px rgba(var(--primary-rgb), 0.1);\n    background: rgba(255, 255, 255, 1);\n  }\n\n  .question-input::placeholder {\n    color: var(--text-secondary);\n    opacity: 0.6;\n  }\n\n  .char-counter {\n    text-align: right;\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    margin-top: 0.5rem;\n  }\n\n  .ask-button {\n    width: 100%;\n    padding: 1rem 2rem;\n    border: none;\n    border-radius: 14px;\n    background: linear-gradient(135deg, var(--primary-color) 0%, rgba(var(--primary-rgb), 0.8) 100%);\n    color: white;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: var(--transition);\n    box-shadow:\n      0 4px 16px rgba(var(--primary-rgb), 0.3),\n      inset 0 1px 0 rgba(255, 255, 255, 0.2);\n    position: relative;\n    overflow: hidden;\n  }\n\n  .ask-button::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    border-radius: 50%;\n    background: rgba(255, 255, 255, 0.3);\n    transform: translate(-50%, -50%);\n    transition: width 0.6s, height 0.6s;\n  }\n\n  .ask-button:hover::before {\n    width: 300px;\n    height: 300px;\n  }\n\n  .ask-button:hover {\n    transform: translateY(-2px);\n    box-shadow:\n      0 8px 24px rgba(var(--primary-rgb), 0.4),\n      inset 0 1px 0 rgba(255, 255, 255, 0.3);\n  }\n\n  .ask-button:active {\n    transform: translateY(0);\n  }\n\n  .ask-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n\n  .loading {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.75rem;\n    padding: 2rem;\n  }\n\n  .spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid rgba(var(--primary-rgb), 0.2);\n    border-top-color: var(--primary-color);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  @keyframes spin {\n    to { transform: rotate(360deg); }\n  }\n\n  .answer-container {\n    background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.03) 0%, rgba(255, 255, 255, 0.5) 100%);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(var(--primary-rgb), 0.15);\n    border-radius: 16px;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    animation: slideIn 0.5s ease-out;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);\n  }\n\n  @keyframes slideIn {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .answer-header {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    margin-bottom: 1rem;\n  }\n\n  .ai-icon {\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, var(--primary-color) 0%, rgba(var(--primary-rgb), 0.7) 100%);\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: bold;\n    box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.3);\n  }\n\n  .answer-title {\n    font-weight: 600;\n    color: var(--text-primary);\n    font-size: 1rem;\n  }\n\n  .confidence-badge {\n    margin-left: auto;\n    padding: 0.25rem 0.75rem;\n    border-radius: 20px;\n    font-size: 0.75rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .confidence-high {\n    background: rgba(16, 185, 129, 0.15);\n    color: #059669;\n    border: 1px solid rgba(16, 185, 129, 0.3);\n  }\n\n  .confidence-medium {\n    background: rgba(251, 191, 36, 0.15);\n    color: #d97706;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n  }\n\n  .confidence-low {\n    background: rgba(239, 68, 68, 0.15);\n    color: #dc2626;\n    border: 1px solid rgba(239, 68, 68, 0.3);\n  }\n\n  .answer-text {\n    font-size: 1rem;\n    line-height: 1.7;\n    color: var(--text-primary);\n  }\n\n  .review-snippets {\n    margin-top: 2rem;\n  }\n\n  .snippets-title {\n    font-size: 0.9rem;\n    font-weight: 600;\n    color: var(--text-secondary);\n    margin-bottom: 1rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .review-snippet {\n    background: rgba(255, 255, 255, 0.8);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(0, 0, 0, 0.06);\n    border-radius: 12px;\n    padding: 1rem;\n    margin-bottom: 0.75rem;\n    transition: var(--transition);\n  }\n\n  .review-snippet:hover {\n    transform: translateX(4px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  }\n\n  .review-rating {\n    color: #fbbf24;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n  }\n\n  .review-text {\n    font-size: 0.95rem;\n    color: var(--text-primary);\n    line-height: 1.6;\n    margin-bottom: 0.5rem;\n  }\n\n  .review-author {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    font-style: italic;\n  }\n\n  .popular-questions {\n    margin-top: 2rem;\n  }\n\n  .popular-title {\n    font-size: 1rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 1rem;\n  }\n\n  .question-buttons {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.75rem;\n  }\n\n  .question-button {\n    padding: 0.6rem 1.2rem;\n    border: 1px solid rgba(var(--primary-rgb), 0.2);\n    border-radius: 24px;\n    background: rgba(255, 255, 255, 0.8);\n    backdrop-filter: blur(10px);\n    color: var(--text-primary);\n    font-size: 0.9rem;\n    cursor: pointer;\n    transition: var(--transition);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n  }\n\n  .question-button:hover {\n    background: var(--primary-color);\n    color: white;\n    border-color: var(--primary-color);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);\n  }\n\n  .error-message {\n    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);\n    border: 1px solid rgba(239, 68, 68, 0.3);\n    border-radius: 12px;\n    padding: 1.25rem;\n    color: #dc2626;\n    margin-bottom: 1.5rem;\n    animation: shake 0.5s;\n  }\n\n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-10px); }\n    75% { transform: translateX(10px); }\n  }\n\n  .hidden {\n    display: none;\n  }\n\n  @media (max-width: 768px) {\n    .widget-container {\n      padding: 1.5rem;\n      border-radius: 16px;\n    }\n\n    .product-header {\n      flex-direction: column;\n      text-align: center;\n    }\n\n    .product-image {\n      width: 100px;\n      height: 100px;\n    }\n\n    .question-input {\n      font-size: 16px; /* Prevent zoom on iOS */\n    }\n  }\n",'</style>\n      <div class="widget-container">\n        ').concat(o?'\n          <div class="error-message">\n            ‚ö†Ô∏è '.concat(o,"\n          </div>\n        "):"","\n\n        ").concat(r&&r.product&&this.state.showProductInfo?'\n          <div class="product-header">\n            '.concat(r.product.imageUrl?'\n              <img src="'.concat(r.product.imageUrl,'" alt="').concat(r.product.name,'" class="product-image">\n            '):"",'\n            <div class="product-info">\n              <div class="product-name">').concat(r.product.name,'</div>\n              <div class="product-rating">\n                <span class="stars">').concat(this.renderStars(r.product.rating),"</span>\n                <span>").concat(r.product.rating,"/10</span>\n                <span>‚Ä¢</span>\n                <span>").concat(r.product.reviewCount," reviews</span>\n              </div>\n            </div>\n          </div>\n        "):"",'\n\n        <form>\n          <div class="question-input-container">\n            <label class="input-label">Stel je vraag over dit product</label>\n            <textarea\n              class="question-input"\n              placeholder="Bijvoorbeeld: Hoe stil is dit apparaat?"\n              maxlength="500"\n              rows="3"\n            ></textarea>\n            <div class="char-counter">0/500</div>\n          </div>\n\n          <button type="submit" class="ask-button" ').concat(e?"disabled":"",">\n            ").concat(e?"Even geduld...":"Stel vraag","\n          </button>\n        </form>\n\n        ").concat(e?'\n          <div class="loading">\n            <div class="spinner"></div>\n            <span>AI analyseert reviews...</span>\n          </div>\n        ':"","\n\n        ").concat(r?'\n          <div class="answer-container">\n            <div class="answer-header">\n              <div class="ai-icon">AI</div>\n              <span class="answer-title">Antwoord gebaseerd op '.concat(r.product.reviewCount,' reviews</span>\n              <span class="confidence-badge confidence-').concat(r.confidence,'">').concat(r.confidence,'</span>\n            </div>\n            <div class="answer-text">').concat(r.answer,"</div>\n\n            ").concat(r.relevantReviews&&r.relevantReviews.length>0?'\n              <div class="review-snippets">\n                <div class="snippets-title">Relevante klantreviews</div>\n                '.concat(r.relevantReviews.map(function(t){return'\n                  <div class="review-snippet">\n                    <div class="review-rating">'.concat(n.renderStars(t.rating)," ").concat(t.rating,'/10</div>\n                    <div class="review-text">"').concat(t.excerpt,'"</div>\n                    <div class="review-author">‚Äî ').concat(t.author,"</div>\n                  </div>\n                ")}).join(""),"\n              </div>\n            "):"","\n          </div>\n        "):"","\n\n        ").concat(!r&&!e&&a.length>0?'\n          <div class="popular-questions">\n            <div class="popular-title">üí° Veelgestelde vragen</div>\n            <div class="question-buttons">\n              '.concat(a.map(function(n,t){return'\n                <button type="button" class="question-button" data-question="'.concat(n.question,'" data-index="').concat(t,'">\n                  ').concat(n.question,"\n                </button>\n              ")}).join(""),"\n            </div>\n          </div>\n        "):"","\n      </div>\n    ");var i=this.shadowRoot.querySelector("form");i&&i.addEventListener("submit",function(t){return n.handleSubmit(t)});var c=this.shadowRoot.querySelector(".question-input");c&&c.addEventListener("input",function(t){return n.handleInputChange(t)}),this.shadowRoot.querySelectorAll(".question-button").forEach(function(t,r){t.addEventListener("click",function(){var t,e=null===(t=a[r])||void 0===t?void 0:t.question;e&&n.handlePopularQuestionClick(e)})})}}],o=[{key:"observedAttributes",get:function(){return["data-location-id","data-product-code","data-auto-detect","data-language","data-primary-color","data-show-product-info","data-api-base-url"]}}],e&&P(r.prototype,e),o&&P(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,e,o,a,i,c,u}(C(HTMLElement));customElements.define("kiyoh-ai-widget",G);function z(){}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",z):z(),n=n.default})());
//# sourceMappingURL=widget.min.js.map